---
lab:
  title: 'ラボ 2: 統合顧客プロファイルを作成する'
---

# ラボ 2: 統合顧客プロファイルを作成する
このラボでは、以下の方法について説明します。
- 生データ ソースのデータを顧客プロファイルにマージする
- 主キーを選択する 
- 一致規則を作成する
- 検索とフィルターのインデックスとアクティビティを定義する

ここでの目的は、**Contoso Retail** が保持しているさまざまなデータ ソース間の一意の顧客プロファイル数を確認することです。

## 演習 1: データを統合する
### タスク 1 - 連絡先を共通のデータ型にマップする
1. **Customer Insights - Data** にサインインします。

1. 左側のナビゲーション メニューで、**[データ]** を展開して、**[統合]** を選択します。 **[Get started](作業を開始する)** を選択します。

1. **[テーブルと列の選択]** を選択します。

1. 顧客プロファイル - **Contacts (eCommerce)** および **Customers (Loyalty)** を表すテーブルを選択します。 **適用**を選択します。

1. 次に、標準モデル タイプに対するソース テーブルのマッピングが表示されます。 テーブル内のタイプを確認できます。

1. 取り込んだ各エンティティの **「主キー」** を選択する必要があります。 主キーは、一意の参照である必要があります。 **eCommerceContacts** については、**ContactId** を主キーとして選択します。

1. **eコマース連絡先**のデータには、**Email Subscriber** という名前の列が含まれています。この列は、その名前のために正しくない型 **(Identity.Service.Email)** にマップされます。 この列のドロップダウンを開き、空のオプション (nothing/blank) を選択します。 これを行わない場合、システムの既定の動作では、このフィールドを **"EMail"** フィールドに結合します。

1. **テーブル**の下の **Loyalty Customers** を選択し、**LoyaltyId** を主キーとして設定します。

1. 左上隅の **[ソース列を保存]** を選択します。

1. **[次へ]** ボタンを選択し、もう一度 **[次へ]** を選択して重複のチェックをスキップし、**照合ルール**のステップに進みます。

### タスク 2: 一致順序を指定する
次のステージでは、プロファイルを結合する順序を選択する必要があります。 属性を結合して、統合プロファイルを完成し、それらの属性に使用するソースの優先順位が設定されるようにします。

1. **プライマリ (最初の) ソース**として、最も完全または正確なプロファイル ソースを選択する必要があります。 **Contacts: eCommerce** がプライマリ (最初の) ソースであることを確認します。

1. **Customers: Loyalty** がリストの 2 番目のソースであることを確認します。 

1. **[すべてのレコードを含める]** が両方のデータ ソースでチェックされていることを確認します。

### タスク 3: 一致規則を作成する
1. **Customers: Loyalty** 行に警告インジケーターがあります。 **[+ ルールの追加]** を選択します。

1. **FullName** を使用して最初の条件を追加します。
    - **Contacts: eCommerce** テーブルで、**FullName** フィールドを選択します。
    - **Customers: Loyalty** テーブルで、**FullName** フィールドを選択します。
    - **[正規化]** のドロップダウンは空白のままにします。
    - **精度レベル**を **[Basic]** に設定します。
    - スライダーを使用して、**精度の値**を **[Exact]** に設定します。
    - **[Rule Name]** に**FullName, Email**という名前を入力します。

1. **[+ 追加]** を選択し、**[条件の追加]** を選択して、メール アドレスの 2 つめの条件を追加します。
    - **Contacts: eCommerce** テーブルで、**EMail** フィールドを選択します。
    - **Customers: Loyalty** テーブルで、**EMail** フィールドを選択します。
    - **[正規化]** のドロップダウンは空白のままにします。
    - **精度レベル**を **[Basic]** に設定します。
    - **精度の値**を **[Exact]** に設定します。

1. **完了** を選択します。

1. [**次へ**] を選択します。

1. **統合データ ビュー**の画面では、変更は行われません。 **[次へ]** を選択して、レビュー画面に移動します。

1. **レビュー**画面で、**[顧客プロファイルの作成]** を選択します。 Customer Insights によって、顧客情報のすべてのソースからの顧客データが照合され、ルールに基づいて固有の顧客プロファイルの数が特定されます。 プロファイルの作成には時間がかかる場合があります。

お疲れさまでした。 **Customer Insights** 内にある複数ソースのデータを統合し、顧客ベース全体のインサイト取得に使用できる、**統合顧客プロファイル**を作成することができました。

## 演習 2: 検索とフィルターのインデックスとアクティビティを構成する
この演習では、Customer Insights ユーザーが統合顧客プロファイルを検索できるように、**検索とフィルター**の条件を設定します。 その後、アクティビティを構成します。

### タスク 1: 検索列とフィルター インデックスを構成する 
1. **Customer Insights** で、左側のナビゲーション メニューから **[顧客]** を選択します。

1. **[検索とフィルター インデックス]** を選択します。 一部のフィールドは既定で既に追加されています。 ツールバーの **[+ 追加]** を選択します。

1. **CustomerId、FirstName、LastName、FullName、DateOfBirth、EMail、PostCode、ContactId (eCommerce_Contacts) および LoyaltyId** を選択します (まだ選択されていない場合)。 チェックされているその他のフィールドの選択を解除します。 **適用**を選択します。

1. **[保存]** を選択します。

1. **[実行]** を選択します。

1. **Customer Insights** で、左側のナビゲーション メニューから **[顧客]** を選択します。 **統合プロファイル**を表す一連の顧客カードが表示されます。 カードを展開して顧客に関する詳細を表示したり、さまざまなフィールドでカードを並べ替えたりすることができます。 ツール バーの **[カードの展開]** と **[並べ替え]** を選択して、これを試してみてください。

1. **顧客の検索**を使用して、統合された顧客プロファイルに関連するテキスト属性を検索できます。 (例: 「1」を検索すると、すべてのテキスト属性が検索され、一致と部分一致が返されます。)

### タスク 2: アクティビティを作成する
1. **Customer Insights** で、左側のナビゲーション メニューの **[データ]、[アクティビティ]** を展開し、**[+ アクティビティの構成]** を選択します。

1. **[テーブルの選択]** をクリックします。

1. **Purchases : eCommerce** と **Purchases : PoS** のテーブルを選択し、**[追加]** を選択します。

1. **Purchases: eCommerce** の場合は、次のように構成します。
    - **アクティビティの種類**を **SalesOrder** に設定します。
    - **主キー**を **PurchaseId** に設定します。

1. **Purchases: PoS** の場合は、次のように構成します。
    - **アクティビティの種類**を **SalesOrder** に設定します。
    - **主キー**を **PurchaseId** に設定します。

1. [**次へ**] を選択します。
   
1. **eCommerce : Purchases** を次のように構成します。
    - **アクティビティ名**に「**OnlinePurchase**」と入力します。
    - 次のフィールドに入力します (記載されていないフィールドの場合は空白のままにします)。
        - **TimeStamp**: PurchasedOn
        - **イベント活動**: ActivityTypeDisplay
        - **[追加の詳細]**: 件名
        - **顧客プロファイルのタイムラインにこの活動を表示しますか?** はい
        - **アイコン**: ショッピング バッグを選択します。
        - **アクティビティの属性にマップ フィールドの種類を設定しますか ?** はい。次のように設定します。
            - **販売注文 ID**: PurchaseID
            - **受注データ**: PurchasedOn
            - **売上高**: TotalPrice

1. **PoS : Purchases** を次のように設定します。
    - **アクティビティ名** に **PoSPurchase** と入力します。
    - 次のフィールドに入力します (記載されていないフィールドの場合は空白のままにします)。
        - **TimeStamp**: PurchasedOn
        - **イベント活動**: ActivityTypeDisplay
        - **[追加の詳細]**: 件名
        - **顧客プロファイルのタイムラインにこの活動を表示しますか?** はい
        - **アイコン**: ショッピング バッグを選択します。
        - **アクティビティの属性にマップ フィールドの種類を設定しますか ?** はい。次のように設定します。
            - **販売注文 ID**: PurchaseID
            - **受注データ**: PurchasedOn
            - **売上高**: TotalPrice

1. [**次へ**] を選択します。

1. **[活動リレーションシップの設定]** 画面で、**eCommerce: Purchases** が選択されている状態で、**[ + リレーションシップの追加]** を選択します。

1. **[リレーションシップ パスの追加]** ウィンドウで、次の値を設定します。
    - **外部キー**: ContactId
    - **宛先テーブル名**: Contacts : eCommerce
    - **リレーションシップ名**: eCommPurchasesToContacts
    - **適用**を選択します。

1. **[PoS : Purchases]** を選択します。 **[+ リレーションシップの追加]** を選択します。

1. **[リレーションシップ パスの追加]** ウィンドウで、次の値を設定します。
    - **外部キー**: LoyaltyId
    - **宛先テーブル名**: Customers : Loyalty
    - **リレーションシップ名**: PoSPurchasesToLoyalty
    - **適用**を選択します。

1. [**次へ**] を選択します。

1. **[活動の作成]** を選択します。

1. **[活動]** が更新され統合されるまで待ちます。



